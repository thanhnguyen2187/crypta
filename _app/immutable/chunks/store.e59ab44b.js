import{t as Te,a as Ue}from"./index.ebdcb085.js";import{J as Fe,a4 as Z,w as Oe,v as je,a5 as U}from"./scheduler.4c6d698c.js";import{w as E,r as Ce,d as He}from"./index.612e0734.js";let ee,F,N,te,ae,ne,re,oe,ie,se,ce,J,de,ue,M,le,fe,pe,P,we,ge,Ne=(async()=>{ae=function(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)},M=function(e,t){Te(e,1,1,()=>{t.delete(e.key)})},ne=function(e,t){e.f(),M(e,t)},we=function(e,t,a,n,i,p,r,s,u,l,w,A){let d=e.length,v=p.length,m=d;const b={};for(;m--;)b[e[m].key]=m;const o=[],D=new Map,I=new Map,k=[];for(m=v;m--;){const f=A(i,p,m),y=a(f);let c=r.get(y);c?n&&k.push(()=>c.p(f,t)):(c=l(y,f),c.c()),D.set(y,o[m]=c),y in b&&I.set(y,Math.abs(m-b[y]))}const S=new Set,h=new Set;function x(f){Ue(f,1),f.m(s,w),r.set(f.key,f),w=f.first,v--}for(;d&&v;){const f=o[v-1],y=e[d-1],c=f.key,g=y.key;f===y?(w=f.first,d--,v--):D.has(g)?!r.has(c)||S.has(c)?x(f):h.has(g)?d--:I.get(c)>I.get(g)?(h.add(c),x(f)):(S.add(g),d--):(u(y,r),d--)}for(;d--;){const f=e[d];D.has(f.key)||u(f,r)}for(;v;)x(o[v-1]);return Fe(k),o},P=E(void 0),se=function(e,t){const{computePosition:a,autoUpdate:n,offset:i,shift:p,flip:r,arrow:s,size:u,autoPlacement:l,hide:w,inline:A}=Z(P),d={open:!1,autoUpdateCleanup:()=>{}},v=':is(a[href], button, input, textarea, select, details, [tabindex]):not([tabindex="-1"])';let m;const b="https://www.skeleton.dev/utilities/popups";let o,D;function I(){o=document.querySelector(`[data-popup="${t.target}"]`)??document.createElement("div"),D=o.querySelector(".arrow")??document.createElement("div")}I();function k(){var g,$,T,_,K,Q,G,R;if(!o)throw new Error(`The data-popup="${t.target}" element was not found. ${b}`);if(!a)throw new Error(`Floating UI 'computePosition' not found for data-popup="${t.target}". ${b}`);if(!i)throw new Error(`Floating UI 'offset' not found for data-popup="${t.target}". ${b}`);if(!p)throw new Error(`Floating UI 'shift' not found for data-popup="${t.target}". ${b}`);if(!r)throw new Error(`Floating UI 'flip' not found for data-popup="${t.target}". ${b}`);if(!s)throw new Error(`Floating UI 'arrow' not found for data-popup="${t.target}". ${b}`);const c=[];u&&c.push(u((g=t.middleware)==null?void 0:g.size)),l&&c.push(l(($=t.middleware)==null?void 0:$.autoPlacement)),w&&c.push(w((T=t.middleware)==null?void 0:T.hide)),A&&c.push(A((_=t.middleware)==null?void 0:_.inline)),a(e,o,{placement:t.placement??"bottom",middleware:[i(((K=t.middleware)==null?void 0:K.offset)??8),p(((Q=t.middleware)==null?void 0:Q.shift)??{padding:8}),r((G=t.middleware)==null?void 0:G.flip),s(((R=t.middleware)==null?void 0:R.arrow)??{element:D||null}),...c]}).then(({x:Ae,y:ke,placement:Le,middlewareData:Ie})=>{if(Object.assign(o.style,{left:`${Ae}px`,top:`${ke}px`}),D){const{x:X,y:Y}=Ie.arrow,$e={top:"bottom",right:"left",bottom:"top",left:"right"}[Le.split("-")[0]];Object.assign(D.style,{left:X!=null?`${X}px`:"",top:Y!=null?`${Y}px`:"",right:"",bottom:"",[$e]:"-4px"})}})}function S(){o&&(d.open=!0,t.state&&t.state({state:d.open}),k(),o.style.display="block",o.style.opacity="1",o.style.pointerEvents="auto",o.removeAttribute("inert"),d.autoUpdateCleanup=n(e,o,k),m=Array.from(o==null?void 0:o.querySelectorAll(v)))}function h(c){if(!o)return;const g=parseFloat(window.getComputedStyle(o).transitionDuration.replace("s",""))*1e3;setTimeout(()=>{d.open=!1,t.state&&t.state({state:d.open}),o.style.opacity="0",o.setAttribute("inert",""),d.autoUpdateCleanup&&d.autoUpdateCleanup(),c&&c()},g)}function x(){d.open===!1?S():h()}function f(c){var $;if(d.open===!1||e.contains(c.target))return;if(o&&o.contains(c.target)===!1){h();return}const g=t.closeQuery===void 0?"a[href], button":t.closeQuery;g!==""&&(($=o==null?void 0:o.querySelectorAll(g))==null||$.forEach(T=>{T.contains(c.target)&&h()}))}const y=c=>{if(d.open===!1)return;const g=c.key;if(g==="Escape"){c.preventDefault(),e.focus(),h();return}m=Array.from(o==null?void 0:o.querySelectorAll(v)),d.open&&document.activeElement===e&&(g==="ArrowDown"||g==="Tab")&&v.length>0&&m.length>0&&(c.preventDefault(),m[0].focus())};switch(t.event){case"click":e.addEventListener("click",x,!0),window.addEventListener("click",f,!0);break;case"hover":e.addEventListener("mouseover",S,!0),e.addEventListener("mouseleave",()=>h(),!0);break;case"focus-blur":e.addEventListener("focus",x,!0),e.addEventListener("blur",()=>h(),!0);break;case"focus-click":e.addEventListener("focus",S,!0),window.addEventListener("click",f,!0);break;default:throw new Error(`Event value of '${t.event}' is not supported. ${b}`)}return window.addEventListener("keydown",y,!0),k(),{update(c){h(()=>{t=c,k(),I()})},destroy(){e.removeEventListener("click",x,!0),e.removeEventListener("mouseover",S,!0),e.removeEventListener("mouseleave",()=>h(),!0),e.removeEventListener("focus",x,!0),e.removeEventListener("focus",S,!0),e.removeEventListener("blur",()=>h(),!0),window.removeEventListener("click",f,!0),window.removeEventListener("keydown",y,!0)}}};const q="modalStore";re=function(){const e=Oe(q);if(!e)throw new Error("modalStore is not initialized. Please ensure that `initializeStores()` is invoked in the root layout file of this app!");return e},ie=function(){const e=me();return je(q,e)};function me(){const{subscribe:e,set:t,update:a}=E([]);return{subscribe:e,set:t,update:a,trigger:n=>a(i=>(i.push(n),i)),close:()=>a(n=>(n.length>0&&n.shift(),n)),clear:()=>t([])}}const O={};function z(e){return e==="local"?localStorage:sessionStorage}function j(e,t,a){const n=(a==null?void 0:a.serializer)??JSON,i=(a==null?void 0:a.storage)??"local";function p(r,s){z(i).setItem(r,n.stringify(s))}if(!O[e]){const r=E(t,l=>{const w=z(i).getItem(e);w&&l(n.parse(w));{const A=d=>{d.key===e&&l(d.newValue?n.parse(d.newValue):null)};return window.addEventListener("storage",A),()=>window.removeEventListener("storage",A)}}),{subscribe:s,set:u}=r;O[e]={set(l){p(e,l),u(l)},update(l){const w=l(Z(r));p(e,w),u(w)},subscribe:s}}return O[e]}j("modeOsPrefers",!1),j("modeUserPrefers",void 0),j("modeCurrent",!1);const B="(prefers-reduced-motion: reduce)";function ye(){return window.matchMedia(B).matches}le=Ce(ye(),e=>{{const t=n=>{e(n.matches)},a=window.matchMedia(B);return a.addEventListener("change",t),()=>{a.removeEventListener("change",t)}}});async function he(e,t){const a=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",a),i=crypto.getRandomValues(new Uint8Array(12)),p=U.Buffer.from(i).toString("base64"),r={name:"AES-GCM",iv:i},s=await crypto.subtle.importKey("raw",n,r,!1,["encrypt"]),u=new TextEncoder().encode(e),l=await crypto.subtle.encrypt(r,s,u),w=U.Buffer.from(l).toString("base64");return`${p}.${w}`}async function ve(e,t){const a=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",a);if(e.indexOf(".")===-1)throw new Error("Invalid ciphertext");const i=e.split("."),p=i[0],r={name:"AES-GCM",iv:U.Buffer.from(p,"base64")},s=await crypto.subtle.importKey("raw",n,r,!1,["decrypt"]),u=i[1],l=U.Buffer.from(u,"base64");try{const w=await crypto.subtle.decrypt(r,s,l);return new TextDecoder().decode(w)}catch{throw new Error("Decrypt failed")}}async function be(){const e=await xe(),t=new Set(e.tags),a=E(e);return{subscribe:a.subscribe,set(n){L(n).then(),a.set(n)},update(n){const i=n(e);L(i).then(),a.set(i)},addTag:n=>{t.add(n),e.tags=Array.from(t),L(e).then(),a.set(e)},removeTag:n=>{t.delete(n),e.tags=Array.from(t),L(e).then(),a.set(e)},setSearchInput:n=>{e.searchInput=n,L(e).then(),a.set(e)},setFolderId:n=>{e.folderId=n,L(e).then(),a.set(e)}}}function Ee(){const e=new Set,t=E(e);return{add:a=>{e.add(a),t.set(e)},remove:a=>{e.delete(a),t.set(e)},subscribe:t.subscribe}}Ee();let V;F=await be(),V={default:{id:"default",displayName:"Default",showLockedCard:!0,position:0,createdAt:new Date().getTime(),updatedAt:new Date().getTime()}};function C(e){return`folder.${e}`}async function De(e="default"){const t=await(await navigator.storage.getDirectory()).getDirectoryHandle(C(e),{create:!0}),a=[];for await(let[n,i]of t)if(i.kind==="file"){const p=await(await i.getFile()).text(),r={id:n.replace(".json",""),...JSON.parse(p)};a.push(r)}return a}async function H(e,t="default"){const a=await(await(await(await navigator.storage.getDirectory()).getDirectoryHandle(C(t),{create:!0})).getFileHandle(`${e.id}.json`,{create:!0})).createWritable();await a.write(JSON.stringify(e)),await a.close()}async function W(e,t="default"){await(await(await navigator.storage.getDirectory()).getDirectoryHandle(C(t),{create:!0})).removeEntry(`${e}.json`)}N=function(){return{id:crypto.randomUUID(),name:"Untitled",language:"plaintext",text:"To be filled",tags:[],encrypted:!1,position:0,updatedAt:new Date().getTime(),createdAt:new Date().getTime()}},ue=async function(e,t){return{...e,encrypted:!0,text:await he(e.text,t),updatedAt:new Date().getTime()}},ce=async function(e,t){return{...e,encrypted:!1,text:await ve(e.text,t),updatedAt:new Date().getTime()}};async function Se(){let e=[],t="default";const a=E(e),{subscribe:n,set:i,update:p}=a;return F.subscribe(async r=>{e=await De(r.folderId),t=r.folderId,i(e)}),{subscribe:n,clone:async r=>{const s={...r,id:crypto.randomUUID(),position:e.length+1,createdAt:new Date().getTime(),updatedAt:new Date().getTime()};await H(s,t),p(u=>(u.push(s),u))},upsert:async r=>{await H(r,t),p(s=>{const u=s.findIndex(l=>l.id===r.id);return u!==-1?s[u]=r:(r.position=s.length+1,s.push(r)),s})},remove:async r=>{await W(r,t),p(s=>{const u=s.findIndex(l=>l.id===r);return u!==-1&&s.splice(u,1),s})},move:async(r,s,u)=>{await W(r.id,s),r.updatedAt=new Date().getTime(),await H(r,u);const l=e.findIndex(w=>w.id===r.id);l!==-1&&e.splice(l,1),i(e)}}}pe=async function(){const e=await(await(await(await navigator.storage.getDirectory()).getFileHandle("catalog.json",{create:!0})).getFile()).text(),t=e?JSON.parse(e):{};return Object.assign({},V,t)},ge=async function(e){const t=await(await(await navigator.storage.getDirectory()).getFileHandle("catalog.json",{create:!0})).createWritable();await t.write(JSON.stringify(e)),await t.close()},oe=function(){return{id:crypto.randomUUID(),displayName:"Untitled",showLockedCard:!0,position:0,createdAt:new Date().getTime(),updatedAt:new Date().getTime()}};async function xe(){const e=await(await(await(await navigator.storage.getDirectory()).getFileHandle("globalState.json",{create:!0})).getFile()).text(),t=e?JSON.parse(e):{};return Object.assign({},{folderId:"default",tags:[],searchInput:""},t)}async function L(e){const t=await(await(await navigator.storage.getDirectory()).getFileHandle("globalState.json",{create:!0})).createWritable();await t.write(JSON.stringify(e)),await t.close()}de=E(N()),ee=E("default"),J=await Se(),fe=He([J,F],([e,t])=>{const a=e.filter(n=>{const i=new Set(n.tags),p=n.name.toLowerCase().includes(t.searchInput)||n.text.toLowerCase().includes(t.searchInput),r=Array.from(t.tags).every(s=>i.has(s));return p&&r});return a.sort((n,i)=>n.position-i.position),a}),te=E(!1)})();export{Ne as __tla,ee as a,F as b,N as c,te as d,ae as e,ne as f,re as g,oe as h,ie as i,se as j,ce as k,J as l,de as m,ue as n,M as o,le as p,fe as q,pe as r,P as s,we as u,ge as w};
