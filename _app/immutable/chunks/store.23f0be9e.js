import{t as Fe,a as Oe}from"./index.ebdcb085.js";import{J as je,a4 as te,w as Ce,v as He,a5 as T}from"./scheduler.4c6d698c.js";import{w as E,r as Ne,d as Je}from"./index.612e0734.js";let ae,C,H,ne,re,oe,ie,se,ce,de,N,J,ue,M,le,fe,pe,we,P,q,ge,me,ye,Me=(async()=>{re=function(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)},q=function(e,t){Fe(e,1,1,()=>{t.delete(e.key)})},oe=function(e,t){e.f(),q(e,t)},ge=function(e,t,a,r,o,f,n,s,d,l,w,A){let u=e.length,v=f.length,m=u;const b={};for(;m--;)b[e[m].key]=m;const i=[],D=new Map,L=new Map,k=[];for(m=v;m--;){const p=A(o,f,m),y=a(p);let c=n.get(y);c?r&&k.push(()=>c.p(p,t)):(c=l(y,p),c.c()),D.set(y,i[m]=c),y in b&&L.set(y,Math.abs(m-b[y]))}const S=new Set,h=new Set;function x(p){Oe(p,1),p.m(s,w),n.set(p.key,p),w=p.first,v--}for(;u&&v;){const p=i[v-1],y=e[u-1],c=p.key,g=y.key;p===y?(w=p.first,u--,v--):D.has(g)?!n.has(c)||S.has(c)?x(p):h.has(g)?u--:L.get(c)>L.get(g)?(h.add(c),x(p)):(S.add(g),u--):(d(y,n),u--)}for(;u--;){const p=e[u];D.has(p.key)||d(p,n)}for(;v;)x(i[v-1]);return je(k),i},P=E(void 0),de=function(e,t){const{computePosition:a,autoUpdate:r,offset:o,shift:f,flip:n,arrow:s,size:d,autoPlacement:l,hide:w,inline:A}=te(P),u={open:!1,autoUpdateCleanup:()=>{}},v=':is(a[href], button, input, textarea, select, details, [tabindex]):not([tabindex="-1"])';let m;const b="https://www.skeleton.dev/utilities/popups";let i,D;function L(){i=document.querySelector(`[data-popup="${t.target}"]`)??document.createElement("div"),D=i.querySelector(".arrow")??document.createElement("div")}L();function k(){var g,$,I,Q,_,R,X,Y;if(!i)throw new Error(`The data-popup="${t.target}" element was not found. ${b}`);if(!a)throw new Error(`Floating UI 'computePosition' not found for data-popup="${t.target}". ${b}`);if(!o)throw new Error(`Floating UI 'offset' not found for data-popup="${t.target}". ${b}`);if(!f)throw new Error(`Floating UI 'shift' not found for data-popup="${t.target}". ${b}`);if(!n)throw new Error(`Floating UI 'flip' not found for data-popup="${t.target}". ${b}`);if(!s)throw new Error(`Floating UI 'arrow' not found for data-popup="${t.target}". ${b}`);const c=[];d&&c.push(d((g=t.middleware)==null?void 0:g.size)),l&&c.push(l(($=t.middleware)==null?void 0:$.autoPlacement)),w&&c.push(w((I=t.middleware)==null?void 0:I.hide)),A&&c.push(A((Q=t.middleware)==null?void 0:Q.inline)),a(e,i,{placement:t.placement??"bottom",middleware:[o(((_=t.middleware)==null?void 0:_.offset)??8),f(((R=t.middleware)==null?void 0:R.shift)??{padding:8}),n((X=t.middleware)==null?void 0:X.flip),s(((Y=t.middleware)==null?void 0:Y.arrow)??{element:D||null}),...c]}).then(({x:Le,y:$e,placement:Ie,middlewareData:Te})=>{if(Object.assign(i.style,{left:`${Le}px`,top:`${$e}px`}),D){const{x:Z,y:ee}=Te.arrow,Ue={top:"bottom",right:"left",bottom:"top",left:"right"}[Ie.split("-")[0]];Object.assign(D.style,{left:Z!=null?`${Z}px`:"",top:ee!=null?`${ee}px`:"",right:"",bottom:"",[Ue]:"-4px"})}})}function S(){i&&(u.open=!0,t.state&&t.state({state:u.open}),k(),i.style.display="block",i.style.opacity="1",i.style.pointerEvents="auto",i.removeAttribute("inert"),u.autoUpdateCleanup=r(e,i,k),m=Array.from(i==null?void 0:i.querySelectorAll(v)))}function h(c){if(!i)return;const g=parseFloat(window.getComputedStyle(i).transitionDuration.replace("s",""))*1e3;setTimeout(()=>{u.open=!1,t.state&&t.state({state:u.open}),i.style.opacity="0",i.setAttribute("inert",""),u.autoUpdateCleanup&&u.autoUpdateCleanup(),c&&c()},g)}function x(){u.open===!1?S():h()}function p(c){var $;if(u.open===!1||e.contains(c.target))return;if(i&&i.contains(c.target)===!1){h();return}const g=t.closeQuery===void 0?"a[href], button":t.closeQuery;g!==""&&(($=i==null?void 0:i.querySelectorAll(g))==null||$.forEach(I=>{I.contains(c.target)&&h()}))}const y=c=>{if(u.open===!1)return;const g=c.key;if(g==="Escape"){c.preventDefault(),e.focus(),h();return}m=Array.from(i==null?void 0:i.querySelectorAll(v)),u.open&&document.activeElement===e&&(g==="ArrowDown"||g==="Tab")&&v.length>0&&m.length>0&&(c.preventDefault(),m[0].focus())};switch(t.event){case"click":e.addEventListener("click",x,!0),window.addEventListener("click",p,!0);break;case"hover":e.addEventListener("mouseover",S,!0),e.addEventListener("mouseleave",()=>h(),!0);break;case"focus-blur":e.addEventListener("focus",x,!0),e.addEventListener("blur",()=>h(),!0);break;case"focus-click":e.addEventListener("focus",S,!0),window.addEventListener("click",p,!0);break;default:throw new Error(`Event value of '${t.event}' is not supported. ${b}`)}return window.addEventListener("keydown",y,!0),k(),{update(c){h(()=>{t=c,k(),L()})},destroy(){e.removeEventListener("click",x,!0),e.removeEventListener("mouseover",S,!0),e.removeEventListener("mouseleave",()=>h(),!0),e.removeEventListener("focus",x,!0),e.removeEventListener("focus",S,!0),e.removeEventListener("blur",()=>h(),!0),window.removeEventListener("click",p,!0),window.removeEventListener("keydown",y,!0)}}};const z="modalStore";ie=function(){const e=Ce(z);if(!e)throw new Error("modalStore is not initialized. Please ensure that `initializeStores()` is invoked in the root layout file of this app!");return e},ce=function(){const e=he();return He(z,e)};function he(){const{subscribe:e,set:t,update:a}=E([]);return{subscribe:e,set:t,update:a,trigger:r=>a(o=>(o.push(r),o)),close:()=>a(r=>(r.length>0&&r.shift(),r)),clear:()=>t([])}}const U={};function B(e){return e==="local"?localStorage:sessionStorage}function F(e,t,a){const r=(a==null?void 0:a.serializer)??JSON,o=(a==null?void 0:a.storage)??"local";function f(n,s){B(o).setItem(n,r.stringify(s))}if(!U[e]){const n=E(t,l=>{const w=B(o).getItem(e);w&&l(r.parse(w));{const A=u=>{u.key===e&&l(u.newValue?r.parse(u.newValue):null)};return window.addEventListener("storage",A),()=>window.removeEventListener("storage",A)}}),{subscribe:s,set:d}=n;U[e]={set(l){f(e,l),d(l)},update(l){const w=l(te(n));f(e,w),d(w)},subscribe:s}}return U[e]}F("modeOsPrefers",!1),F("modeUserPrefers",void 0),F("modeCurrent",!1);const V="(prefers-reduced-motion: reduce)";function ve(){return window.matchMedia(V).matches}fe=Ne(ve(),e=>{{const t=r=>{e(r.matches)},a=window.matchMedia(V);return a.addEventListener("change",t),()=>{a.removeEventListener("change",t)}}});async function be(e,t){const a=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",a),o=crypto.getRandomValues(new Uint8Array(12)),f=T.Buffer.from(o).toString("base64"),n={name:"AES-GCM",iv:o},s=await crypto.subtle.importKey("raw",r,n,!1,["encrypt"]),d=new TextEncoder().encode(e),l=await crypto.subtle.encrypt(n,s,d),w=T.Buffer.from(l).toString("base64");return`${f}.${w}`}async function Ee(e,t){const a=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",a);if(e.indexOf(".")===-1)throw new Error("Invalid ciphertext");const o=e.split("."),f=o[0],n={name:"AES-GCM",iv:T.Buffer.from(f,"base64")},s=await crypto.subtle.importKey("raw",r,n,!1,["decrypt"]),d=o[1],l=T.Buffer.from(d,"base64");try{const w=await crypto.subtle.decrypt(n,s,l);return new TextDecoder().decode(w)}catch{throw new Error("Decrypt failed")}}async function De(){const e=await ke(),t=new Set(e.tags),a=E(e);return{subscribe:a.subscribe,set(r){K(r).then(),a.set(r)},update(r){const o=r(e);K(o).then(),a.set(o)},addTag:r=>{t.add(r),e.tags=Array.from(t),a.set(e)},removeTag:r=>{t.delete(r),e.tags=Array.from(t),a.set(e)},setSearchInput:r=>{e.searchInput=r,a.set(e)},setFolderId:r=>{e.folderId=r,a.set(e)}}}function Se(){const e=new Set,t=E(e);return{add:a=>{e.add(a),t.set(e)},remove:a=>{e.delete(a),t.set(e)},subscribe:t.subscribe}}let W;N=Se(),C=E("default"),M=await De(),W={default:{id:"default",displayName:"Default",showLockedCard:!0,position:0,createdAt:new Date().getTime(),updatedAt:new Date().getTime()}};function O(e){return`folder.${e}`}async function xe(e="default"){const t=await(await navigator.storage.getDirectory()).getDirectoryHandle(O(e),{create:!0}),a=[];for await(let[r,o]of t)if(o.kind==="file"){const f=await(await o.getFile()).text(),n={id:r.replace(".json",""),...JSON.parse(f)};a.push(n)}return a}async function j(e,t="default"){const a=await(await(await(await navigator.storage.getDirectory()).getDirectoryHandle(O(t),{create:!0})).getFileHandle(`${e.id}.json`,{create:!0})).createWritable();await a.write(JSON.stringify(e)),await a.close()}async function G(e,t="default"){await(await(await navigator.storage.getDirectory()).getDirectoryHandle(O(t),{create:!0})).removeEntry(`${e}.json`)}H=function(){return{id:crypto.randomUUID(),name:"Untitled",language:"plaintext",text:"To be filled",tags:[],encrypted:!1,position:0,updatedAt:new Date().getTime(),createdAt:new Date().getTime()}},pe=async function(e,t){return{...e,encrypted:!0,text:await be(e.text,t),updatedAt:new Date().getTime()}},le=async function(e,t){return{...e,encrypted:!1,text:await Ee(e.text,t),updatedAt:new Date().getTime()}};async function Ae(){let e=[],t="default";const a=E(e),{subscribe:r,set:o,update:f}=a;return C.subscribe(async n=>{e=await xe(n),t=n,o(e)}),{subscribe:r,clone:async n=>{const s={...n,id:crypto.randomUUID(),position:e.length+1,createdAt:new Date().getTime(),updatedAt:new Date().getTime()};await j(s,t),f(d=>(d.push(s),d))},upsert:async n=>{await j(n,t),f(s=>{const d=s.findIndex(l=>l.id===n.id);return d!==-1?s[d]=n:(n.position=s.length+1,s.push(n)),s})},remove:async n=>{await G(n,t),f(s=>{const d=s.findIndex(l=>l.id===n);return d!==-1&&s.splice(d,1),s})},move:async(n,s,d)=>{await G(n.id,s),n.updatedAt=new Date().getTime(),await j(n,d);const l=e.findIndex(w=>w.id===n.id);l!==-1&&e.splice(l,1),o(e)}}}we=async function(){const e=await(await(await(await navigator.storage.getDirectory()).getFileHandle("catalog.json",{create:!0})).getFile()).text(),t=e?JSON.parse(e):{};return Object.assign({},W,t)},ye=async function(e){const t=await(await(await navigator.storage.getDirectory()).getFileHandle("catalog.json",{create:!0})).createWritable();await t.write(JSON.stringify(e)),await t.close()},se=function(){return{id:crypto.randomUUID(),displayName:"Untitled",showLockedCard:!0,position:0,createdAt:new Date().getTime(),updatedAt:new Date().getTime()}};async function ke(){const e=await(await(await(await navigator.storage.getDirectory()).getFileHandle("globalState.json",{create:!0})).getFile()).text(),t=e?JSON.parse(e):{};return Object.assign({},{folderId:"default",tags:[],searchInput:""},t)}async function K(e){const t=await(await(await navigator.storage.getDirectory()).getFileHandle("globalState.json",{create:!0})).createWritable();await t.write(JSON.stringify(e)),await t.close()}ue=E(H()),ae=E("default"),J=await Ae(),me=Je([J,N,M],([e,t,a])=>{const r=e.filter(o=>{const f=new Set(o.tags),n=o.name.toLowerCase().includes(a.searchInput)||o.text.toLowerCase().includes(a.searchInput),s=Array.from(t.keys()).every(d=>f.has(d));return n&&s});return r.sort((o,f)=>o.position-f.position),r}),ne=E(!1)})();export{Me as __tla,ae as a,C as b,H as c,ne as d,re as e,oe as f,ie as g,se as h,ce as i,de as j,N as k,J as l,ue as m,M as n,le as o,fe as p,pe as q,we as r,P as s,q as t,ge as u,me as v,ye as w};
