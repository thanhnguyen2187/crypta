import{t as Ue,a as Te}from"./index.71bac9b2.js";import{J as Ie,a4 as ee,w as Ce,v as Fe,a5 as T}from"./scheduler.cc2bcdfb.js";import{w as E,r as Oe,d as je}from"./index.ffbbc9f8.js";let j,te,H,ae,ne,re,oe,ie,se,ce,M,N,de,P,ue,le,fe,pe,q,J,we,me,ge,He=(async()=>{ne=function(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)},J=function(e,t){Ue(e,1,1,()=>{t.delete(e.key)})},re=function(e,t){e.f(),J(e,t)},we=function(e,t,n,c,s,f,a,o,d,l,w,A){let u=e.length,h=f.length,g=u;const b={};for(;g--;)b[e[g].key]=g;const r=[],D=new Map,S=new Map,L=[];for(g=h;g--;){const p=A(s,f,g),y=n(p);let i=a.get(y);i?c&&L.push(()=>i.p(p,t)):(i=l(y,p),i.c()),D.set(y,r[g]=i),y in b&&S.set(y,Math.abs(g-b[y]))}const k=new Set,v=new Set;function x(p){Te(p,1),p.m(o,w),a.set(p.key,p),w=p.first,h--}for(;u&&h;){const p=r[h-1],y=e[u-1],i=p.key,m=y.key;p===y?(w=p.first,u--,h--):D.has(m)?!a.has(i)||k.has(i)?x(p):v.has(m)?u--:S.get(i)>S.get(m)?(v.add(i),x(p)):(k.add(m),u--):(d(y,a),u--)}for(;u--;){const p=e[u];D.has(p.key)||d(p,a)}for(;h;)x(r[h-1]);return Ie(L),r},q=E(void 0),ce=function(e,t){const{computePosition:n,autoUpdate:c,offset:s,shift:f,flip:a,arrow:o,size:d,autoPlacement:l,hide:w,inline:A}=ee(q),u={open:!1,autoUpdateCleanup:()=>{}},h=':is(a[href], button, input, textarea, select, details, [tabindex]):not([tabindex="-1"])';let g;const b="https://www.skeleton.dev/utilities/popups";let r,D;function S(){r=document.querySelector(`[data-popup="${t.target}"]`)??document.createElement("div"),D=r.querySelector(".arrow")??document.createElement("div")}S();function L(){var m,$,U,K,Q,W,R,X;if(!r)throw new Error(`The data-popup="${t.target}" element was not found. ${b}`);if(!n)throw new Error(`Floating UI 'computePosition' not found for data-popup="${t.target}". ${b}`);if(!s)throw new Error(`Floating UI 'offset' not found for data-popup="${t.target}". ${b}`);if(!f)throw new Error(`Floating UI 'shift' not found for data-popup="${t.target}". ${b}`);if(!a)throw new Error(`Floating UI 'flip' not found for data-popup="${t.target}". ${b}`);if(!o)throw new Error(`Floating UI 'arrow' not found for data-popup="${t.target}". ${b}`);const i=[];d&&i.push(d((m=t.middleware)==null?void 0:m.size)),l&&i.push(l(($=t.middleware)==null?void 0:$.autoPlacement)),w&&i.push(w((U=t.middleware)==null?void 0:U.hide)),A&&i.push(A((K=t.middleware)==null?void 0:K.inline)),n(e,r,{placement:t.placement??"bottom",middleware:[s(((Q=t.middleware)==null?void 0:Q.offset)??8),f(((W=t.middleware)==null?void 0:W.shift)??{padding:8}),a((R=t.middleware)==null?void 0:R.flip),o(((X=t.middleware)==null?void 0:X.arrow)??{element:D||null}),...i]}).then(({x:xe,y:Ae,placement:Le,middlewareData:Se})=>{if(Object.assign(r.style,{left:`${xe}px`,top:`${Ae}px`}),D){const{x:Y,y:Z}=Se.arrow,$e={top:"bottom",right:"left",bottom:"top",left:"right"}[Le.split("-")[0]];Object.assign(D.style,{left:Y!=null?`${Y}px`:"",top:Z!=null?`${Z}px`:"",right:"",bottom:"",[$e]:"-4px"})}})}function k(){r&&(u.open=!0,t.state&&t.state({state:u.open}),L(),r.style.display="block",r.style.opacity="1",r.style.pointerEvents="auto",r.removeAttribute("inert"),u.autoUpdateCleanup=c(e,r,L),g=Array.from(r==null?void 0:r.querySelectorAll(h)))}function v(i){if(!r)return;const m=parseFloat(window.getComputedStyle(r).transitionDuration.replace("s",""))*1e3;setTimeout(()=>{u.open=!1,t.state&&t.state({state:u.open}),r.style.opacity="0",r.setAttribute("inert",""),u.autoUpdateCleanup&&u.autoUpdateCleanup(),i&&i()},m)}function x(){u.open===!1?k():v()}function p(i){var $;if(u.open===!1||e.contains(i.target))return;if(r&&r.contains(i.target)===!1){v();return}const m=t.closeQuery===void 0?"a[href], button":t.closeQuery;m!==""&&(($=r==null?void 0:r.querySelectorAll(m))==null||$.forEach(U=>{U.contains(i.target)&&v()}))}const y=i=>{if(u.open===!1)return;const m=i.key;if(m==="Escape"){i.preventDefault(),e.focus(),v();return}g=Array.from(r==null?void 0:r.querySelectorAll(h)),u.open&&document.activeElement===e&&(m==="ArrowDown"||m==="Tab")&&h.length>0&&g.length>0&&(i.preventDefault(),g[0].focus())};switch(t.event){case"click":e.addEventListener("click",x,!0),window.addEventListener("click",p,!0);break;case"hover":e.addEventListener("mouseover",k,!0),e.addEventListener("mouseleave",()=>v(),!0);break;case"focus-blur":e.addEventListener("focus",x,!0),e.addEventListener("blur",()=>v(),!0);break;case"focus-click":e.addEventListener("focus",k,!0),window.addEventListener("click",p,!0);break;default:throw new Error(`Event value of '${t.event}' is not supported. ${b}`)}return window.addEventListener("keydown",y,!0),L(),{update(i){v(()=>{t=i,L(),S()})},destroy(){e.removeEventListener("click",x,!0),e.removeEventListener("mouseover",k,!0),e.removeEventListener("mouseleave",()=>v(),!0),e.removeEventListener("focus",x,!0),e.removeEventListener("focus",k,!0),e.removeEventListener("blur",()=>v(),!0),window.removeEventListener("click",p,!0),window.removeEventListener("keydown",y,!0)}}};const z="modalStore";oe=function(){const e=Ce(z);if(!e)throw new Error("modalStore is not initialized. Please ensure that `initializeStores()` is invoked in the root layout file of this app!");return e},se=function(){const e=ye();return Fe(z,e)};function ye(){const{subscribe:e,set:t,update:n}=E([]);return{subscribe:e,set:t,update:n,trigger:c=>n(s=>(s.push(c),s)),close:()=>n(c=>(c.length>0&&c.shift(),c)),clear:()=>t([])}}const I={};function B(e){return e==="local"?localStorage:sessionStorage}function C(e,t,n){const c=(n==null?void 0:n.serializer)??JSON,s=(n==null?void 0:n.storage)??"local";function f(a,o){B(s).setItem(a,c.stringify(o))}if(!I[e]){const a=E(t,l=>{const w=B(s).getItem(e);w&&l(c.parse(w));{const A=u=>{u.key===e&&l(u.newValue?c.parse(u.newValue):null)};return window.addEventListener("storage",A),()=>window.removeEventListener("storage",A)}}),{subscribe:o,set:d}=a;I[e]={set(l){f(e,l),d(l)},update(l){const w=l(ee(a));f(e,w),d(w)},subscribe:o}}return I[e]}C("modeOsPrefers",!1),C("modeUserPrefers",void 0),C("modeCurrent",!1);const V="(prefers-reduced-motion: reduce)";function ve(){return window.matchMedia(V).matches}le=Oe(ve(),e=>{{const t=c=>{e(c.matches)},n=window.matchMedia(V);return n.addEventListener("change",t),()=>{n.removeEventListener("change",t)}}});async function he(e,t){const n=new TextEncoder().encode(t),c=await crypto.subtle.digest("SHA-256",n),s=crypto.getRandomValues(new Uint8Array(12)),f=T.Buffer.from(s).toString("base64"),a={name:"AES-GCM",iv:s},o=await crypto.subtle.importKey("raw",c,a,!1,["encrypt"]),d=new TextEncoder().encode(e),l=await crypto.subtle.encrypt(a,o,d),w=T.Buffer.from(l).toString("base64");return`${f}.${w}`}async function be(e,t){const n=new TextEncoder().encode(t),c=await crypto.subtle.digest("SHA-256",n);if(e.indexOf(".")===-1)throw new Error("Invalid ciphertext");const s=e.split("."),f=s[0],a={name:"AES-GCM",iv:T.Buffer.from(f,"base64")},o=await crypto.subtle.importKey("raw",c,a,!1,["decrypt"]),d=s[1],l=T.Buffer.from(d,"base64");try{const w=await crypto.subtle.decrypt(a,o,l);return new TextDecoder().decode(w)}catch{throw new Error("Decrypt failed")}}function Ee(){const e=new Set,t=E(e);return{add:n=>{e.add(n),t.set(e)},remove:n=>{e.delete(n),t.set(e)},subscribe:t.subscribe}}let _;M=Ee(),P=E(""),j=E("default"),_={default:{id:"default",displayName:"Default",showLockedCard:!0,position:0,createdAt:new Date().getTime(),updatedAt:new Date().getTime()}};function F(e){return`folder.${e}`}async function De(e="default"){const t=await(await navigator.storage.getDirectory()).getDirectoryHandle(F(e),{create:!0}),n=[];for await(let[c,s]of t)if(s.kind==="file"){const f=await(await s.getFile()).text(),a={id:c.replace(".json",""),...JSON.parse(f)};n.push(a)}return n}async function O(e,t="default"){const n=await(await(await(await navigator.storage.getDirectory()).getDirectoryHandle(F(t),{create:!0})).getFileHandle(`${e.id}.json`,{create:!0})).createWritable();await n.write(JSON.stringify(e)),await n.close()}async function G(e,t="default"){await(await(await navigator.storage.getDirectory()).getDirectoryHandle(F(t),{create:!0})).removeEntry(`${e}.json`)}H=function(){return{id:crypto.randomUUID(),name:"Untitled",language:"plaintext",text:"To be filled",tags:[],encrypted:!1,position:0,updatedAt:new Date().getTime(),createdAt:new Date().getTime()}},fe=async function(e,t){return{...e,encrypted:!0,text:await he(e.text,t),updatedAt:new Date().getTime()}},ue=async function(e,t){return{...e,encrypted:!1,text:await be(e.text,t),updatedAt:new Date().getTime()}};async function ke(){let e=[],t="default";const n=E(e),{subscribe:c,set:s,update:f}=n;return j.subscribe(async a=>{e=await De(a),t=a,s(e)}),{subscribe:c,clone:async a=>{const o={...a,id:crypto.randomUUID(),position:e.length+1,createdAt:new Date().getTime(),updatedAt:new Date().getTime()};await O(o,t),f(d=>(d.push(o),d))},upsert:async a=>{await O(a,t),f(o=>{const d=o.findIndex(l=>l.id===a.id);return d!==-1?o[d]=a:(a.position=o.length+1,o.push(a)),o})},remove:async a=>{await G(a,t),f(o=>{const d=o.findIndex(l=>l.id===a);return d!==-1&&o.splice(d,1),o})},move:async(a,o,d)=>{await G(a.id,o),a.updatedAt=new Date().getTime(),await O(a,d);const l=e.findIndex(w=>w.id===a.id);l!==-1&&e.splice(l,1),s(e)}}}pe=async function(){const e=await(await(await(await navigator.storage.getDirectory()).getFileHandle("catalog.json",{create:!0})).getFile()).text(),t=e?JSON.parse(e):{};return Object.assign({},_,t)},ge=async function(e){const t=await(await(await navigator.storage.getDirectory()).getFileHandle("catalog.json",{create:!0})).createWritable();await t.write(JSON.stringify(e)),await t.close()},ie=function(){return{id:crypto.randomUUID(),displayName:"Untitled",showLockedCard:!0,position:0,createdAt:new Date().getTime(),updatedAt:new Date().getTime()}},de=E(H()),te=E("default"),N=await ke(),me=je([N,M,P],([e,t,n])=>{n=n.toLowerCase();const c=e.filter(s=>{const f=new Set(s.tags),a=s.name.toLowerCase().includes(n)||s.text.toLowerCase().includes(n),o=Array.from(t.keys()).every(d=>f.has(d));return a&&o});return c.sort((s,f)=>s.position-f.position),c}),ae=E(!1)})();export{He as __tla,j as a,te as b,H as c,ae as d,ne as e,re as f,oe as g,ie as h,se as i,ce as j,M as k,N as l,de as m,P as n,ue as o,le as p,fe as q,pe as r,q as s,J as t,we as u,me as v,ge as w};
